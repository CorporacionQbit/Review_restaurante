<div class="restaurant-detail" *ngIf="restaurant">

  <!-- HERO -->
  <section
    class="hero"
    [style.backgroundImage]="
      restaurant.images?.length
        ? 'url(http://localhost:3000/' + restaurant.images[0].imageUrl + ')'
        : 'linear-gradient(135deg, #222, #444)'
    "
  >
    <div class="hero-overlay"></div>

    <div class="hero-content">
      <h1>{{ restaurant.name }}</h1>

      <div class="hero-rating">
        <nz-rate [ngModel]="restaurant.avgRating" nzDisabled></nz-rate>
        <span class="meta">
          {{ restaurant.avgRating || 0 }} Â· {{ restaurant.totalReviews }} reseÃ±as
        </span>
        <span *ngIf="restaurant.isPremium" class="badge">Premium</span>
      </div>

      <p class="hero-description">
        {{ restaurant.description || 'Sin descripciÃ³n disponible' }}
      </p>
    </div>
  </section>

  <!-- CONTENT -->
  <section class="content">

    <!-- LEFT -->
    <div class="left">

      <!-- GALERÃA -->
      <nz-card nzTitle="GalerÃ­a">
        <div class="gallery-pro" *ngIf="restaurant.images?.length; else noImages">
          <div
            class="main-image"
            [style.backgroundImage]="'url(http://localhost:3000/' + restaurant.images[0].imageUrl + ')'"
          ></div>

          <div class="thumbs">
            <div
              class="thumb"
              *ngFor="let img of restaurant.images.slice(1)"
              [style.backgroundImage]="'url(http://localhost:3000/' + img.imageUrl + ')'"
            ></div>
          </div>
        </div>

        <ng-template #noImages>
          <p class="empty">Este restaurante aÃºn no tiene imÃ¡genes.</p>
        </ng-template>
      </nz-card>

      <!-- RESEÃ‘AS -->
      <nz-card nzTitle="ReseÃ±as" class="mt">
        <div *ngIf="reviews.length; else noReviews">
          <div class="review-card" *ngFor="let r of reviews">
            <div class="avatar">
              {{ r.user?.fullName?.charAt(0) || 'U' }}
            </div>
            <div class="review-content">
              <nz-rate [ngModel]="r.rating" nzDisabled></nz-rate>
              <p>{{ r.reviewText }}</p>
            </div>
          </div>
        </div>

        <ng-template #noReviews>
          <p class="empty">AÃºn no hay reseÃ±as.</p>
        </ng-template>
      </nz-card>

      <!-- FORMULARIO -->
      <nz-card nzTitle="Escribir reseÃ±a" class="mt review-form">
        <p class="hint">Comparte tu experiencia con otros usuarios.</p>

        <nz-rate [(ngModel)]="rating"></nz-rate>

        <textarea
          nz-input
          rows="4"
          [(ngModel)]="reviewText"
          placeholder="Â¿QuÃ© te gustÃ³ o no te gustÃ³?"
        ></textarea>

        <button
          nz-button
          nzType="primary"
          class="mt"
          [disabled]="loading"
          (click)="submitReview()"
        >
          Enviar reseÃ±a
        </button>
      </nz-card>

    </div>

    <!-- RIGHT -->
    <div class="right">

      <!-- MAPA -->
      <nz-card nzTitle="UbicaciÃ³n">
        <div *ngIf="isPremium() && safeMapUrl; else noMap">
          <iframe
            [src]="safeMapUrl"
            width="100%"
            height="220"
            style="border:0; border-radius: 10px;"
            loading="lazy">
          </iframe>
        </div>

        <ng-template #noMap>
          <p class="empty">ğŸ“ Disponible solo para restaurantes Premium.</p>
        </ng-template>
      </nz-card>

      <!-- MENÃš -->
      <nz-card nzTitle="MenÃº" class="mt">
        <a
          *ngIf="restaurant.menus?.length"
          nz-button
          nzType="primary"
          target="_blank"
          [href]="restaurant.menus[0].menuUrl"
        >
          ğŸ½ï¸ Ver menÃº
        </a>
      </nz-card>

      <!-- POSTS -->
      <nz-card nzTitle="Novedades" class="mt">
        <div *ngFor="let p of restaurant.posts" class="post">
          <strong>{{ p.title }}</strong>
          <p>{{ p.content }}</p>
        </div>
      </nz-card>

    </div>
  </section>
</div>