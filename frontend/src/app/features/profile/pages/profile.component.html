<!-- ========================= -->
<!-- ‚è≥ SKELETON LOADER -->
<!-- ========================= -->
<div class="profile-container" *ngIf="loading">

  <section class="profile-header skeleton-card">
    <div class="avatar skeleton-avatar"></div>
    <div class="profile-info">
      <div class="skeleton-line w-60"></div>
      <div class="skeleton-line w-40"></div>
      <div class="skeleton-line w-30"></div>
    </div>
  </section>

  <section class="stats">
    <div class="stat-card skeleton-card"></div>
    <div class="stat-card skeleton-card"></div>
  </section>

</div>

<!-- ========================= -->
<!-- üë§ PERFIL -->
<!-- ========================= -->
<div class="profile-container" *ngIf="!loading">

  <!-- ‚¨ÖÔ∏è BACK -->
  <div class="top-bar">
    <button class="back-btn" (click)="goBack()">‚Üê Regresar</button>
  </div>

  <!-- PERFIL HEADER -->
  <section class="profile-header">
    <div class="avatar">
      {{ user?.fullName?.charAt(0) || 'U' }}
    </div>

    <div class="profile-info">
      <h1>{{ user?.fullName }}</h1>
      <p class="email">{{ user?.email }}</p>
      <p class="member">
        Miembro desde {{ user?.createdAt | date:'longDate' }}
      </p>
    </div>
  </section>

  <!-- STATS -->
  <section class="stats">
    <div class="stat-card">
      <h2>{{ reviews.length }}</h2>
      <span>Rese√±as</span>
    </div>

    <div class="stat-card">
      <h2>{{ averageRating }}</h2>
      <span>Rating promedio</span>
    </div>
  </section>

  <!-- ========================= -->
  <!-- ‚≠ê MIS RESE√ëAS -->
  <!-- ========================= -->
  <section class="reviews-section">

    <h2>Mis rese√±as</h2>

    <div class="review-card" *ngFor="let r of reviews">

      <div class="review-header">
        <strong>{{ r.restaurant?.name }}</strong>
        <nz-rate
          *ngIf="editingReviewId !== r.reviewId"
          [ngModel]="r.rating"
          nzDisabled>
        </nz-rate>
      </div>

      <p *ngIf="editingReviewId !== r.reviewId">
        {{ r.reviewText || 'Sin comentario' }}
      </p>

      <!-- EDIT -->
      <div *ngIf="editingReviewId === r.reviewId" class="edit-box">
        <nz-rate [(ngModel)]="editRating"></nz-rate>

        <textarea
          nz-input
          rows="3"
          [(ngModel)]="editText">
        </textarea>

        <div class="actions">
          <button nz-button nzType="primary" (click)="saveEdit(r.reviewId)">
            Guardar
          </button>
          <button nz-button nzType="default" (click)="cancelEdit()">
            Cancelar
          </button>
        </div>
      </div>

      <div class="review-footer" *ngIf="editingReviewId !== r.reviewId">
        <span class="date">
          {{ r.createdAt | date:'mediumDate' }}
        </span>

        <div class="actions">
          <button nz-button nzType="link" (click)="goToRestaurant(r.restaurantId)">
            Ver restaurante
          </button>
          <button nz-button nzType="link" (click)="startEdit(r)">
            Editar
          </button>
          <button nz-button nzType="link" nzDanger (click)="deleteReview(r.reviewId)">
            Eliminar
          </button>
        </div>
      </div>

    </div>

    <div *ngIf="!reviews.length" class="empty">
      A√∫n no has escrito rese√±as
    </div>

  </section>

  <!-- ========================= -->
  <!-- ‚ù§Ô∏è FAVORITOS -->
  <!-- ========================= -->
  <section class="favorites-section">

    <h2>‚ù§Ô∏è Mis restaurantes favoritos</h2>

    <div *ngIf="favoritesLoading" class="loading">
      Cargando favoritos...
    </div>

    <div *ngIf="!favoritesLoading && favorites.length === 0" class="empty">
      A√∫n no has agregado restaurantes a favoritos
    </div>

    <div class="favorites-grid" *ngIf="favorites.length">

      <div
        class="favorite-card"
        *ngFor="let f of favorites"
        (click)="goToRestaurant(f.restaurant_id)"
      >
        <h3>{{ f.name }}</h3>

        <nz-rate [ngModel]="f.avg_rating" nzDisabled></nz-rate>

        <p class="meta">
          {{ f.total_reviews }} rese√±as
          <span *ngIf="f.is_premium" class="premium">‚≠ê Premium</span>
        </p>

        <p class="desc">
          {{ f.description || 'Sin descripci√≥n' }}
        </p>
      </div>

    </div>

  </section>

</div>
